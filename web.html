<!DOCTYPE html>
<html>
<head>
    <title>WebSocket demo</title>
    <style type="text/css">
        body {
            font-family: "Courier New", sans-serif;
        }
    </style>
</head>
<body>
<div class="">
    state: <span class="state"></span>
</div>
<div class="">
    uid: <input type="text" value="" name="uid" id="uid"/> <input type="submit" value="register" id="register">
</div>
<div class="">
    debug: <pre class="debug"></pre>
</div>
<script>
    let element_debug = document.querySelector('.debug'),
        element_state = document.querySelector('.state'),
        element_uid = document.getElementById("uid"),
        element_register = document.getElementById("register"),
        uid = Math.floor((Math.random() * 5) + 1);
    element_uid.value = uid;
    websocket = new WebSocket("ws://127.0.0.1:6789/");
    websocket.onopen = function (event) {
        console.log("WebSocket is open now.");
        register_uid();
    };

    element_register.onclick = function () {
        register_uid();
    };

    function register_uid() {
        uid = element_uid.value;
        let data = JSON.stringify({action: 'register', 'uid': uid})
        console.log(data);
        websocket.send(data);
    }

    websocket.onmessage = function (event) {
        let data = JSON.parse(event.data);
        console.log("data", data);
        element_debug.textContent = element_debug.textContent + event.data + "\n";
        switch (data.type) {
            case 'state':
                element_state.textContent = data.value;
                break;
            case 'ping':
                alert('ping: reload data...')
                break;
            default:
                console.log("unsupported event", data);
        }
    };
</script>
</body>
</html>
